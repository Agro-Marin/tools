# Plan de Desarrollo 1: Sistema de Procesamiento de Data Maestra

**Fecha:** 2025-10-01
**VersiÃ³n:** 1.0
**Premisa:** La data sucia **ya estÃ¡ extraÃ­da en archivos CSV** listos para procesar
**Objetivo:** Procesar, limpiar y validar data maestra lista para importar a BD Odoo

---

## ğŸ“‹ ÃNDICE

1. [Premisa y Contexto](#premisa-y-contexto)
2. [Diagrama de Flujo LÃ³gico Completo](#diagrama-de-flujo-lÃ³gico-completo)
3. [Estructura de Directorios](#estructura-de-directorios)
4. [Estructura JSON de ConfiguraciÃ³n](#estructura-json-de-configuraciÃ³n)
5. [Componentes del Sistema](#componentes-del-sistema)
6. [DescripciÃ³n de las 6 Operaciones](#descripciÃ³n-de-las-6-operaciones)
7. [Ejemplo de EjecuciÃ³n](#ejemplo-de-ejecuciÃ³n)
8. [Plan de ImplementaciÃ³n](#plan-de-implementaciÃ³n)

---

## ğŸ¯ PREMISA Y CONTEXTO

### Punto de Partida

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          DIRECTORIO CON DATA EXTRAÃDA               â”‚
â”‚       =========================================      â”‚
â”‚                                                     â”‚
â”‚  data/input/                                        â”‚
â”‚  â”œâ”€ res_partner.csv (8,590 registros)              â”‚
â”‚  â”‚   â””â”€ IDs: 1, 5, 27, 103, 8590, 8591...         â”‚
â”‚  â”‚   â””â”€ Sin External IDs                           â”‚
â”‚  â”‚   â””â”€ Puede tener registros duplicados           â”‚
â”‚  â”‚                                                  â”‚
â”‚  â”œâ”€ product_template.csv (3,200 registros)          â”‚
â”‚  â”‚   â””â”€ IDs dispersos                              â”‚
â”‚  â”‚   â””â”€ Relaciones con categorÃ­as                  â”‚
â”‚  â”‚                                                  â”‚
â”‚  â”œâ”€ stock_warehouse.csv (15 registros)              â”‚
â”‚  â”‚   â””â”€ IDs: 1, 2, 5, 101, 102...                 â”‚
â”‚  â”‚                                                  â”‚
â”‚  â””â”€ account_move.csv (12,000 registros)            â”‚
â”‚      â””â”€ Datos transaccionales                      â”‚
â”‚                                                     â”‚
â”‚  Problemas:                                         â”‚
â”‚  â”œâ”€ IDs con huecos y desordenados                  â”‚
â”‚  â”œâ”€ Sin External IDs (ir.model.data)               â”‚
â”‚  â”œâ”€ Registros potencialmente duplicados            â”‚
â”‚  â”œâ”€ Relaciones pueden estar rotas                  â”‚
â”‚  â””â”€ Datos sin validar                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Objetivo Final

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         DIRECTORIO CON DATA MAESTRA LIMPIA          â”‚
â”‚       =========================================      â”‚
â”‚                                                     â”‚
â”‚  data/output/                                       â”‚
â”‚  â”œâ”€ res_partner_clean.csv                           â”‚
â”‚  â”‚   â””â”€ IDs: 1, 2, 3, 4, 5... (consecutivos)       â”‚
â”‚  â”‚   â””â”€ Todos con External ID                      â”‚
â”‚  â”‚   â””â”€ Sin duplicados                             â”‚
â”‚  â”‚   â””â”€ Validados y limpios                        â”‚
â”‚  â”‚                                                  â”‚
â”‚  â”œâ”€ product_template_clean.csv                      â”‚
â”‚  â”‚   â””â”€ IDs: 1000, 1001, 1002... (consecutivos)    â”‚
â”‚  â”‚   â””â”€ Con External IDs                           â”‚
â”‚  â”‚   â””â”€ Relaciones verificadas                     â”‚
â”‚  â”‚                                                  â”‚
â”‚  â”œâ”€ stock_warehouse_clean.csv                       â”‚
â”‚  â”‚   â””â”€ IDs: 1, 2, 3... (consecutivos)             â”‚
â”‚  â”‚   â””â”€ Data validada                              â”‚
â”‚  â”‚                                                  â”‚
â”‚  â””â”€ metadata/                                       â”‚
â”‚      â”œâ”€ ir_model_data.csv  â† External IDs          â”‚
â”‚      â””â”€ processing_report.json                     â”‚
â”‚                                                     â”‚
â”‚  âœ“ Listos para importar en Odoo                    â”‚
â”‚  âœ“ IDs consecutivos y ordenados                    â”‚
â”‚  âœ“ External IDs generados                          â”‚
â”‚  âœ“ Relaciones correctas                            â”‚
â”‚  âœ“ Datos validados                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š DIAGRAMA DE FLUJO LÃ“GICO COMPLETO

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            INICIO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              â”‚
                              â”‚ Usuario ejecuta: python run_processor.py
                              v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FASE 1: CARGA DE CONFIGURACIÃ“N                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                 â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  config/models_config.json                 â”‚                 â”‚
â”‚  â”‚  {                                         â”‚                 â”‚
â”‚  â”‚    "global_settings": {                    â”‚                 â”‚
â”‚  â”‚      "input_directory": "data/input",      â”‚                 â”‚
â”‚  â”‚      "output_directory": "data/output",    â”‚                 â”‚
â”‚  â”‚      "external_id_module": "marin_data",   â”‚                 â”‚
â”‚  â”‚      "stop_on_error": true                 â”‚                 â”‚
â”‚  â”‚    },                                      â”‚                 â”‚
â”‚  â”‚    "execution_plan": [                     â”‚                 â”‚
â”‚  â”‚      {                                     â”‚                 â”‚
â”‚  â”‚        "model_name": "res.partner",        â”‚                 â”‚
â”‚  â”‚        "input_file": "res_partner.csv",    â”‚                 â”‚
â”‚  â”‚        "operations": {                     â”‚                 â”‚
â”‚  â”‚          "data_cleaning": [...],           â”‚                 â”‚
â”‚  â”‚          "resequence_ids": {...},          â”‚                 â”‚
â”‚  â”‚          "generate_metadata": {...}        â”‚                 â”‚
â”‚  â”‚        },                                  â”‚                 â”‚
â”‚  â”‚        "export": {                         â”‚                 â”‚
â”‚  â”‚          "output_file": "res_partner_clean.csv",             â”‚
â”‚  â”‚          "fields": ["id", "name", ...]     â”‚                 â”‚
â”‚  â”‚        }                                   â”‚                 â”‚
â”‚  â”‚      }                                     â”‚                 â”‚
â”‚  â”‚    ]                                       â”‚                 â”‚
â”‚  â”‚  }                                         â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚               â”‚                                                  â”‚
â”‚               v                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚     ConfigLoader                           â”‚                 â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                 â”‚
â”‚  â”‚  â€¢ Cargar JSON                             â”‚                 â”‚
â”‚  â”‚  â€¢ Validar schema                          â”‚                 â”‚
â”‚  â”‚  â€¢ Verificar archivos de entrada existen   â”‚                 â”‚
â”‚  â”‚  â€¢ Preparar plan de ejecuciÃ³n              â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚               â”‚                                                  â”‚
â”‚               v                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  ValidaciÃ³n exitosa                        â”‚                 â”‚
â”‚  â”‚  â€¢ 15 modelos configurados                 â”‚                 â”‚
â”‚  â”‚  â€¢ Archivos de entrada verificados         â”‚                 â”‚
â”‚  â”‚  â€¢ Directorio de salida preparado          â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ Config validada, iniciar procesamiento
                v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FASE 2: ORQUESTACIÃ“N - LOOP POR MODELO                         â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                     â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚     Orchestrator                           â”‚                 â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                 â”‚
â”‚  â”‚                                            â”‚                 â”‚
â”‚  â”‚  for model_config in execution_plan:       â”‚                 â”‚
â”‚  â”‚      if not model_config['enabled']:       â”‚                 â”‚
â”‚  â”‚          continue                          â”‚                 â”‚
â”‚  â”‚                                            â”‚                 â”‚
â”‚  â”‚      logger.info(f"Procesando {model}")    â”‚                 â”‚
â”‚  â”‚      process_model(model_config)           â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚               â”‚                                                  â”‚
â”‚               â”‚ Modelo actual: res.partner                       â”‚
â”‚               v                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  1. Cargar CSV de entrada                  â”‚                 â”‚
â”‚  â”‚     â””â”€ data/input/res_partner.csv          â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FASE 3: CARGA DE DATA SUCIA                                    â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                     â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚     CSVReader                              â”‚                 â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                 â”‚
â”‚  â”‚  â€¢ Leer res_partner.csv                    â”‚                 â”‚
â”‚  â”‚  â€¢ Parsear columnas                        â”‚                 â”‚
â”‚  â”‚  â€¢ Validar tipos de datos bÃ¡sicos          â”‚                 â”‚
â”‚  â”‚  â€¢ Cargar en memoria (o chunks)            â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚               â”‚                                                  â”‚
â”‚               v                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  DataFrame / Lista de registros            â”‚                 â”‚
â”‚  â”‚  [                                         â”‚                 â”‚
â”‚  â”‚    {id: 1, name: "John", email: "..."},    â”‚                 â”‚
â”‚  â”‚    {id: 5, name: "Jane", email: "..."},    â”‚                 â”‚
â”‚  â”‚    {id: 27, name: "Acme", email: "..."},   â”‚                 â”‚
â”‚  â”‚    ...                                     â”‚                 â”‚
â”‚  â”‚  ]                                         â”‚                 â”‚
â”‚  â”‚  Total: 8,590 registros cargados           â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ Data cargada en memoria
                v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FASE 4: EJECUCIÃ“N DE 6 OPERACIONES                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                             â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  OPERACIÃ“N 1: FK REDEFINITION (Opcional/Skip en CSV)       â”‚ â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  âš ï¸ Esta operaciÃ³n es principalmente para BD              â”‚ â”‚
â”‚  â”‚  En procesamiento CSV: SKIP o validar integridad          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Alternativa: Validar que las relaciones existan          â”‚ â”‚
â”‚  â”‚  â€¢ Verificar parent_id existe en registros                 â”‚ â”‚
â”‚  â”‚  â€¢ Marcar registros con FK rotas                           â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Resultado: ValidaciÃ³n de integridad referencial           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                           â”‚                                      â”‚
â”‚                           v                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  OPERACIÃ“N 2: DATA CLEANING                                â”‚ â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  A. Limpieza por condiciones                               â”‚ â”‚
â”‚  â”‚     config = {                                             â”‚ â”‚
â”‚  â”‚       "type": "filter",                                    â”‚ â”‚
â”‚  â”‚       "conditions": [                                      â”‚ â”‚
â”‚  â”‚         "active == True",                                  â”‚ â”‚
â”‚  â”‚         "email is not null"                                â”‚ â”‚
â”‚  â”‚       ]                                                    â”‚ â”‚
â”‚  â”‚     }                                                      â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚     # Filtrar registros                                    â”‚ â”‚
â”‚  â”‚     registros_limpios = [                                  â”‚ â”‚
â”‚  â”‚       r for r in registros                                 â”‚ â”‚
â”‚  â”‚       if r['active'] == True and r['email']                â”‚ â”‚
â”‚  â”‚     ]                                                      â”‚ â”‚
â”‚  â”‚     # Antes: 8,590 â†’ DespuÃ©s: 8,340 registros              â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  B. Eliminar duplicados                                    â”‚ â”‚
â”‚  â”‚     config = {                                             â”‚ â”‚
â”‚  â”‚       "type": "deduplicate",                               â”‚ â”‚
â”‚  â”‚       "key_fields": ["email", "vat"]                       â”‚ â”‚
â”‚  â”‚     }                                                      â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚     # Detectar y eliminar duplicados                       â”‚ â”‚
â”‚  â”‚     registros_unicos = remove_duplicates(                  â”‚ â”‚
â”‚  â”‚       registros_limpios,                                   â”‚ â”‚
â”‚  â”‚       keys=['email', 'vat']                                â”‚ â”‚
â”‚  â”‚     )                                                      â”‚ â”‚
â”‚  â”‚     # 8,340 â†’ 8,325 registros (15 duplicados eliminados)   â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  C. Normalizar datos                                       â”‚ â”‚
â”‚  â”‚     â€¢ Limpiar espacios en blanco                           â”‚ â”‚
â”‚  â”‚     â€¢ Normalizar emails (lowercase)                        â”‚ â”‚
â”‚  â”‚     â€¢ Formatear telÃ©fonos                                  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Resultado: 8,325 registros limpios y validados            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                           â”‚                                      â”‚
â”‚                           v                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  OPERACIÃ“N 3: ID RESEQUENCING                              â”‚ â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Entrada: IDs dispersos [1, 5, 27, 103, 8590, 8591...]    â”‚ â”‚
â”‚  â”‚  Salida:  IDs consecutivos [1, 2, 3, 4, 5, 6, 7...]       â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  config = {                                                â”‚ â”‚
â”‚  â”‚    "enabled": true,                                        â”‚ â”‚
â”‚  â”‚    "start_id": 1,                                          â”‚ â”‚
â”‚  â”‚    "order_by": ["id"]                                      â”‚ â”‚
â”‚  â”‚  }                                                         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  1. Ordenar registros                                      â”‚ â”‚
â”‚  â”‚     registros_ordenados = sorted(                          â”‚ â”‚
â”‚  â”‚       registros_limpios,                                   â”‚ â”‚
â”‚  â”‚       key=lambda x: x['id']                                â”‚ â”‚
â”‚  â”‚     )                                                      â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  2. Crear mapeo old_id â†’ new_id                            â”‚ â”‚
â”‚  â”‚     id_map = {}                                            â”‚ â”‚
â”‚  â”‚     new_id = 1  # start_id                                 â”‚ â”‚
â”‚  â”‚     for registro in registros_ordenados:                   â”‚ â”‚
â”‚  â”‚       id_map[registro['id']] = new_id                      â”‚ â”‚
â”‚  â”‚       registro['id_original'] = registro['id']             â”‚ â”‚
â”‚  â”‚       registro['id'] = new_id                              â”‚ â”‚
â”‚  â”‚       new_id += 1                                          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚     # Mapeo creado:                                        â”‚ â”‚
â”‚  â”‚     # {1: 1, 5: 2, 27: 3, 103: 4, 8590: 5, 8591: 6, ...}  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  3. Actualizar FKs en registros                            â”‚ â”‚
â”‚  â”‚     for registro in registros_ordenados:                   â”‚ â”‚
â”‚  â”‚       if registro.get('parent_id'):                        â”‚ â”‚
â”‚  â”‚         old_parent = registro['parent_id']                 â”‚ â”‚
â”‚  â”‚         registro['parent_id'] = id_map.get(old_parent)     â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Resultado: 8,325 registros con IDs consecutivos [1-8325]  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                           â”‚                                      â”‚
â”‚                           v                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  OPERACIÃ“N 4: METADATA GENERATION                          â”‚ â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Generar External IDs para todos los registros             â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  config = {                                                â”‚ â”‚
â”‚  â”‚    "enabled": true,                                        â”‚ â”‚
â”‚  â”‚    "module": "marin_data",                                 â”‚ â”‚
â”‚  â”‚    "name_template": "partner_{id}"                         â”‚ â”‚
â”‚  â”‚  }                                                         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  metadata_records = []                                     â”‚ â”‚
â”‚  â”‚  for registro in registros_ordenados:                      â”‚ â”‚
â”‚  â”‚    external_id = f"marin_data.partner_{registro['id']}"    â”‚ â”‚
â”‚  â”‚    registro['external_id'] = external_id                   â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚    # Crear registro para ir.model.data                     â”‚ â”‚
â”‚  â”‚    metadata_records.append({                               â”‚ â”‚
â”‚  â”‚      'module': 'marin_data',                               â”‚ â”‚
â”‚  â”‚      'name': f"partner_{registro['id']}",                  â”‚ â”‚
â”‚  â”‚      'model': 'res.partner',                               â”‚ â”‚
â”‚  â”‚      'res_id': registro['id']                              â”‚ â”‚
â”‚  â”‚    })                                                      â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Resultado:                                                â”‚ â”‚
â”‚  â”‚  â€¢ 8,325 registros con External ID                         â”‚ â”‚
â”‚  â”‚  â€¢ Archivo metadata/ir_model_data.csv generado             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                           â”‚                                      â”‚
â”‚                           v                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  OPERACIÃ“N 5: M2M HANDLING                                 â”‚ â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Procesar relaciones Many2Many                             â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Si hay archivo: res_partner_category_rel.csv              â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  1. Cargar archivo de relaciÃ³n M2M                         â”‚ â”‚
â”‚  â”‚     m2m_records = CSVReader.read(                          â”‚ â”‚
â”‚  â”‚       'res_partner_category_rel.csv'                       â”‚ â”‚
â”‚  â”‚     )                                                      â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  2. Actualizar IDs con mapeo                               â”‚ â”‚
â”‚  â”‚     for rel in m2m_records:                                â”‚ â”‚
â”‚  â”‚       rel['partner_id'] = id_map[rel['partner_id']]        â”‚ â”‚
â”‚  â”‚       rel['category_id'] = cat_id_map[rel['category_id']]  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  3. Exportar relaciÃ³n actualizada                          â”‚ â”‚
â”‚  â”‚     CSVWriter.write(                                       â”‚ â”‚
â”‚  â”‚       m2m_records,                                         â”‚ â”‚
â”‚  â”‚       'res_partner_category_rel_clean.csv'                 â”‚ â”‚
â”‚  â”‚     )                                                      â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Resultado: Archivos M2M actualizados con nuevos IDs       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                           â”‚                                      â”‚
â”‚                           v                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  OPERACIÃ“N 6: SEQUENCE UPDATE (Skip en CSV)               â”‚ â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  âš ï¸ Esta operaciÃ³n es para BD PostgreSQL                   â”‚ â”‚
â”‚  â”‚  En procesamiento CSV: SKIP                                â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Alternativa: Generar archivo de secuencias                â”‚ â”‚
â”‚  â”‚  sequences.json:                                           â”‚ â”‚
â”‚  â”‚  {                                                         â”‚ â”‚
â”‚  â”‚    "res_partner_id_seq": 8326,                             â”‚ â”‚
â”‚  â”‚    "product_template_id_seq": 3201,                        â”‚ â”‚
â”‚  â”‚    ...                                                     â”‚ â”‚
â”‚  â”‚  }                                                         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Resultado: Archivo con valores para setval()              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Operaciones completadas
                            v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FASE 5: EXPORTACIÃ“N DE DATA LIMPIA                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                             â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚     CSVExporter                            â”‚                 â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                 â”‚
â”‚  â”‚                                            â”‚                 â”‚
â”‚  â”‚  config = {                                â”‚                 â”‚
â”‚  â”‚    "output_file": "res_partner_clean.csv", â”‚                 â”‚
â”‚  â”‚    "fields": [                             â”‚                 â”‚
â”‚  â”‚      "id",                                 â”‚                 â”‚
â”‚  â”‚      "external_id",                        â”‚                 â”‚
â”‚  â”‚      "id_original",                        â”‚                 â”‚
â”‚  â”‚      "name",                               â”‚                 â”‚
â”‚  â”‚      "email",                              â”‚                 â”‚
â”‚  â”‚      "parent_id",                          â”‚                 â”‚
â”‚  â”‚      "category_id"                         â”‚                 â”‚
â”‚  â”‚    ]                                       â”‚                 â”‚
â”‚  â”‚  }                                         â”‚                 â”‚
â”‚  â”‚                                            â”‚                 â”‚
â”‚  â”‚  1. Seleccionar campos                     â”‚                 â”‚
â”‚  â”‚  2. Formatear datos                        â”‚                 â”‚
â”‚  â”‚  3. Escribir CSV                           â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚               â”‚                                                  â”‚
â”‚               v                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  data/output/res_partner_clean.csv         â”‚                 â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚                 â”‚
â”‚  â”‚  id,external_id,id_original,name,email,... â”‚                 â”‚
â”‚  â”‚  1,marin_data.partner_1,1,John,john@...,   â”‚                 â”‚
â”‚  â”‚  2,marin_data.partner_2,5,Jane,jane@...,   â”‚                 â”‚
â”‚  â”‚  3,marin_data.partner_3,27,Acme,acme@...,  â”‚                 â”‚
â”‚  â”‚  ...                                       â”‚                 â”‚
â”‚  â”‚                                            â”‚                 â”‚
â”‚  â”‚  âœ“ 8,325 registros exportados              â”‚                 â”‚
â”‚  â”‚  âœ“ IDs consecutivos [1-8325]               â”‚                 â”‚
â”‚  â”‚  âœ“ Con External IDs                        â”‚                 â”‚
â”‚  â”‚  âœ“ Relaciones actualizadas                 â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ CSV limpio guardado
                v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FASE 6: GENERACIÃ“N DE REPORTES                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                     â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  Generar estadÃ­sticas y logs               â”‚                 â”‚
â”‚  â”‚                                            â”‚                 â”‚
â”‚  â”‚  processing_report.json:                   â”‚                 â”‚
â”‚  â”‚  {                                         â”‚                 â”‚
â”‚  â”‚    "model": "res.partner",                 â”‚                 â”‚
â”‚  â”‚    "input_file": "res_partner.csv",        â”‚                 â”‚
â”‚  â”‚    "output_file": "res_partner_clean.csv", â”‚                 â”‚
â”‚  â”‚    "statistics": {                         â”‚                 â”‚
â”‚  â”‚      "records_input": 8590,                â”‚                 â”‚
â”‚  â”‚      "records_cleaned": 8340,              â”‚                 â”‚
â”‚  â”‚      "records_duplicates": 15,             â”‚                 â”‚
â”‚  â”‚      "records_output": 8325,               â”‚                 â”‚
â”‚  â”‚      "ids_resequenced": 8325,              â”‚                 â”‚
â”‚  â”‚      "external_ids_created": 8325          â”‚                 â”‚
â”‚  â”‚    },                                      â”‚                 â”‚
â”‚  â”‚    "operations_executed": [                â”‚                 â”‚
â”‚  â”‚      "data_cleaning",                      â”‚                 â”‚
â”‚  â”‚      "id_resequencing",                    â”‚                 â”‚
â”‚  â”‚      "metadata_generation"                 â”‚                 â”‚
â”‚  â”‚    ],                                      â”‚                 â”‚
â”‚  â”‚    "errors": [],                           â”‚                 â”‚
â”‚  â”‚    "warnings": [                           â”‚                 â”‚
â”‚  â”‚      "15 registros duplicados eliminados"  â”‚                 â”‚
â”‚  â”‚    ]                                       â”‚                 â”‚
â”‚  â”‚  }                                         â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ Loop continÃºa con siguiente modelo
                â”‚ (product.template, stock.warehouse, etc)
                v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FASE 7: FINALIZACIÃ“N                                            â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                             â”‚
â”‚                                                                  â”‚
â”‚  â€¢ Generar resumen global                                        â”‚
â”‚  â€¢ Consolidar logs                                               â”‚
â”‚  â€¢ Generar archivo de importaciÃ³n para Odoo                      â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  Resumen Global                            â”‚                 â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚                 â”‚
â”‚  â”‚                                            â”‚                 â”‚
â”‚  â”‚  Modelos procesados: 15 / 15               â”‚                 â”‚
â”‚  â”‚  â”œâ”€ res.partner: 8,325 registros           â”‚                 â”‚
â”‚  â”‚  â”œâ”€ product.template: 3,180 registros      â”‚                 â”‚
â”‚  â”‚  â”œâ”€ stock.warehouse: 15 registros          â”‚                 â”‚
â”‚  â”‚  â””â”€ ...                                    â”‚                 â”‚
â”‚  â”‚                                            â”‚                 â”‚
â”‚  â”‚  Operaciones totales:                      â”‚                 â”‚
â”‚  â”‚  â”œâ”€ Registros procesados: 45,230           â”‚                 â”‚
â”‚  â”‚  â”œâ”€ Registros limpiados: 44,100            â”‚                 â”‚
â”‚  â”‚  â”œâ”€ Duplicados eliminados: 1,130           â”‚                 â”‚
â”‚  â”‚  â”œâ”€ IDs re-secuenciados: 44,100            â”‚                 â”‚
â”‚  â”‚  â””â”€ External IDs creados: 44,100           â”‚                 â”‚
â”‚  â”‚                                            â”‚                 â”‚
â”‚  â”‚  Archivos generados:                       â”‚                 â”‚
â”‚  â”‚  â”œâ”€ 15 CSVs limpios en data/output/       â”‚                 â”‚
â”‚  â”‚  â”œâ”€ 1 archivo ir_model_data.csv            â”‚                 â”‚
â”‚  â”‚  â”œâ”€ 15 reportes JSON                       â”‚                 â”‚
â”‚  â”‚  â””â”€ 1 resumen global                       â”‚                 â”‚
â”‚  â”‚                                            â”‚                 â”‚
â”‚  â”‚  Tiempo total: 2m 15s                      â”‚                 â”‚
â”‚  â”‚  Estado: âœ“ EXITOSO                         â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              v
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            FIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ“ ESTRUCTURA DE DIRECTORIOS

```
proyecto_limpieza_data_maestra/
â”‚
â”œâ”€â”€ README.md                          # DocumentaciÃ³n del proyecto
â”œâ”€â”€ requirements.txt                   # Dependencias Python
â”œâ”€â”€ setup.py                          # InstalaciÃ³n del paquete
â”œâ”€â”€ .gitignore                        # Archivos a ignorar
â”‚
â”œâ”€â”€ config/                           # Configuraciones
â”‚   â”œâ”€â”€ models_config.json            # â† CONFIGURACIÃ“N PRINCIPAL
â”‚   â”œâ”€â”€ config_schema.json            # JSON Schema para validaciÃ³n
â”‚   â”‚
â”‚   â””â”€â”€ models/                       # Configs individuales por modelo
â”‚       â”œâ”€â”€ res_partner.json
â”‚       â”œâ”€â”€ product_template.json
â”‚       â””â”€â”€ stock_warehouse.json
â”‚
â”œâ”€â”€ data/                             # Datos de entrada/salida
â”‚   â”œâ”€â”€ input/                        # â† DATA SUCIA (ya extraÃ­da)
â”‚   â”‚   â”œâ”€â”€ res_partner.csv
â”‚   â”‚   â”œâ”€â”€ product_template.csv
â”‚   â”‚   â”œâ”€â”€ stock_warehouse.csv
â”‚   â”‚   â”œâ”€â”€ account_move.csv
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ output/                       # â† DATA LIMPIA (resultado)
â”‚       â”œâ”€â”€ res_partner_clean.csv
â”‚       â”œâ”€â”€ product_template_clean.csv
â”‚       â”œâ”€â”€ stock_warehouse_clean.csv
â”‚       â”‚
â”‚       â”œâ”€â”€ metadata/                 # Archivos de metadata
â”‚       â”‚   â”œâ”€â”€ ir_model_data.csv    # External IDs
â”‚       â”‚   â””â”€â”€ sequences.json       # Valores de secuencias
â”‚       â”‚
â”‚       â””â”€â”€ reports/                  # Reportes por modelo
â”‚           â”œâ”€â”€ res_partner_report.json
â”‚           â”œâ”€â”€ product_template_report.json
â”‚           â””â”€â”€ global_summary.json
â”‚
â”œâ”€â”€ logs/                             # Logs de ejecuciÃ³n
â”‚   â”œâ”€â”€ processor_20251001_143000.log
â”‚   â”œâ”€â”€ errors.log
â”‚   â””â”€â”€ debug.log
â”‚
â”œâ”€â”€ src/                              # CÃ³digo fuente
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                         # Componentes nÃºcleo
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ orchestrator.py           # â† ORQUESTADOR PRINCIPAL
â”‚   â”‚   â”‚   # MÃ©todos:
â”‚   â”‚   â”‚   # - load_config()
â”‚   â”‚   â”‚   # - execute_plan()
â”‚   â”‚   â”‚   # - process_model()
â”‚   â”‚   â”‚   # - generate_summary()
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ config_loader.py          # Carga y valida JSON
â”‚   â”‚       # - load()
â”‚   â”‚       # - validate_schema()
â”‚   â”‚       # - verify_input_files()
â”‚   â”‚
â”‚   â”œâ”€â”€ readers/                      # Lectores de datos
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ csv_reader.py             # Lee CSVs
â”‚   â”‚   â”‚   # - read()
â”‚   â”‚   â”‚   # - read_in_chunks()
â”‚   â”‚   â”‚   # - validate_columns()
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ json_reader.py            # Lee JSONs
â”‚   â”‚
â”‚   â”œâ”€â”€ operations/                   # â† EJECUTORES DE OPERACIONES
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ operation_executor.py     # Ejecutor principal
â”‚   â”‚   â”‚   # - execute_all_operations()
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ op2_data_cleaning.py      # OperaciÃ³n 2
â”‚   â”‚   â”‚   # - filter_records()
â”‚   â”‚   â”‚   # - remove_duplicates()
â”‚   â”‚   â”‚   # - normalize_data()
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ op3_id_resequencing.py    # OperaciÃ³n 3
â”‚   â”‚   â”‚   # - resequence_ids()
â”‚   â”‚   â”‚   # - create_id_mapping()
â”‚   â”‚   â”‚   # - update_foreign_keys()
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ op4_metadata_generator.py # OperaciÃ³n 4
â”‚   â”‚   â”‚   # - generate_external_ids()
â”‚   â”‚   â”‚   # - create_metadata_file()
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ op5_m2m_handler.py        # OperaciÃ³n 5
â”‚   â”‚       # - process_m2m_relations()
â”‚   â”‚       # - update_relation_ids()
â”‚   â”‚
â”‚   â”œâ”€â”€ exporters/                    # Exportadores
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ csv_exporter.py           # Exporta CSVs limpios
â”‚   â”‚   â”‚   # - export_to_csv()
â”‚   â”‚   â”‚   # - format_fields()
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ report_generator.py       # Genera reportes
â”‚   â”‚       # - generate_model_report()
â”‚   â”‚       # - generate_global_summary()
â”‚   â”‚
â”‚   â”œâ”€â”€ validators/                   # Validadores
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ data_validator.py         # Valida datos
â”‚   â”‚   â”‚   # - validate_record()
â”‚   â”‚   â”‚   # - validate_foreign_keys()
â”‚   â”‚   â”‚   # - validate_data_types()
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ integrity_checker.py      # Verifica integridad
â”‚   â”‚       # - check_referential_integrity()
â”‚   â”‚       # - check_duplicates()
â”‚   â”‚
â”‚   â””â”€â”€ utils/                        # Utilidades
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ logger.py                 # Sistema de logging
â”‚       â”œâ”€â”€ helpers.py                # Funciones auxiliares
â”‚       â””â”€â”€ progress_tracker.py       # Seguimiento de progreso
â”‚
â”œâ”€â”€ scripts/                          # Scripts de ejecuciÃ³n
â”‚   â”œâ”€â”€ run_processor.py              # â† SCRIPT PRINCIPAL
â”‚   â”‚   # Uso:
â”‚   â”‚   # python scripts/run_processor.py --config config/models_config.json
â”‚   â”‚
â”‚   â”œâ”€â”€ validate_config.py            # Valida configuraciÃ³n
â”‚   â”œâ”€â”€ validate_input_files.py       # Valida archivos de entrada
â”‚   â”œâ”€â”€ generate_config_template.py   # Genera template de config
â”‚   â””â”€â”€ compare_before_after.py       # Compara input vs output
â”‚
â”œâ”€â”€ tests/                            # Tests
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ unit/                         # Tests unitarios
â”‚   â”‚   â”œâ”€â”€ test_config_loader.py
â”‚   â”‚   â”œâ”€â”€ test_csv_reader.py
â”‚   â”‚   â”œâ”€â”€ test_id_resequencer.py
â”‚   â”‚   â”œâ”€â”€ test_data_cleaning.py
â”‚   â”‚   â””â”€â”€ test_csv_exporter.py
â”‚   â”‚
â”‚   â”œâ”€â”€ integration/                  # Tests de integraciÃ³n
â”‚   â”‚   â”œâ”€â”€ test_full_pipeline.py
â”‚   â”‚   â””â”€â”€ test_orchestrator.py
â”‚   â”‚
â”‚   â””â”€â”€ fixtures/                     # Datos de prueba
â”‚       â”œâ”€â”€ sample_input.csv
â”‚       â”œâ”€â”€ sample_config.json
â”‚       â””â”€â”€ expected_output.csv
â”‚
â””â”€â”€ docs/                             # DocumentaciÃ³n
    â”œâ”€â”€ architecture.md               # Arquitectura del sistema
    â”œâ”€â”€ configuration_guide.md        # GuÃ­a de configuraciÃ³n
    â”œâ”€â”€ operations_reference.md       # Referencia de operaciones
    â”œâ”€â”€ user_guide.md                 # GuÃ­a de usuario
    â”‚
    â””â”€â”€ examples/                     # Ejemplos
        â”œâ”€â”€ example_basic.md
        â””â”€â”€ example_advanced.md
```

---

## ğŸ“„ ESTRUCTURA JSON DE CONFIGURACIÃ“N

### Archivo: `config/models_config.json`

```json
{
  "global_settings": {
    "input_directory": "data/input",
    "output_directory": "data/output",
    "external_id_module": "marin_data",
    "log_level": "INFO",
    "stop_on_error": true,
    "generate_reports": true
  },

  "execution_plan": [
    {
      "model_name": "res.partner",
      "description": "Procesamiento de contactos y empresas",
      "enabled": true,
      "priority": 1,

      "input": {
        "file": "res_partner.csv",
        "encoding": "utf-8",
        "delimiter": ",",
        "has_header": true
      },

      "operations": {
        "data_cleaning": {
          "enabled": true,
          "filters": [
            {
              "type": "condition",
              "field": "active",
              "operator": "==",
              "value": true
            },
            {
              "type": "not_null",
              "fields": ["name", "email"]
            }
          ],
          "deduplicate": {
            "enabled": true,
            "key_fields": ["email", "vat"],
            "keep": "first"
          },
          "normalize": {
            "email": "lowercase",
            "name": "title_case",
            "phone": "format_phone"
          }
        },

        "resequence_ids": {
          "enabled": true,
          "start_id": 1,
          "order_by": ["id"],
          "keep_original_id": true
        },

        "generate_metadata": {
          "enabled": true,
          "module": "marin_data",
          "name_template": "partner_{id}",
          "include_all": true
        },

        "m2m_relationships": [
          {
            "relation_file": "res_partner_category_rel.csv",
            "column1": "partner_id",
            "column2": "category_id",
            "output_file": "res_partner_category_rel_clean.csv"
          }
        ]
      },

      "export": {
        "enabled": true,
        "output_file": "res_partner_clean.csv",
        "fields": [
          "id",
          "external_id",
          "id_original",
          "name",
          "ref",
          "email",
          "phone",
          "mobile",
          "vat",
          "street",
          "city",
          "zip",
          "country_id",
          "state_id",
          "parent_id",
          "category_id",
          "is_company",
          "active"
        ],
        "include_metadata": true
      }
    },

    {
      "model_name": "product.template",
      "description": "Procesamiento de plantillas de productos",
      "enabled": true,
      "priority": 2,

      "input": {
        "file": "product_template.csv",
        "encoding": "utf-8"
      },

      "operations": {
        "data_cleaning": {
          "enabled": true,
          "filters": [
            {
              "type": "not_null",
              "fields": ["name", "default_code"]
            }
          ],
          "deduplicate": {
            "enabled": true,
            "key_fields": ["default_code"],
            "keep": "first"
          }
        },

        "resequence_ids": {
          "enabled": true,
          "start_id": 1000,
          "order_by": ["id"]
        },

        "generate_metadata": {
          "enabled": true,
          "module": "marin_data",
          "name_template": "product_template_{id}"
        }
      },

      "export": {
        "enabled": true,
        "output_file": "product_template_clean.csv",
        "fields": [
          "id",
          "external_id",
          "name",
          "default_code",
          "barcode",
          "list_price",
          "standard_price",
          "categ_id",
          "uom_id",
          "uom_po_id",
          "type",
          "active"
        ]
      }
    },

    {
      "model_name": "stock.warehouse",
      "description": "Procesamiento de almacenes",
      "enabled": true,
      "priority": 3,

      "input": {
        "file": "stock_warehouse.csv"
      },

      "operations": {
        "resequence_ids": {
          "enabled": true,
          "start_id": 1,
          "order_by": ["id"]
        },

        "generate_metadata": {
          "enabled": true,
          "module": "marin_data",
          "name_template": "warehouse_{id}"
        }
      },

      "export": {
        "enabled": true,
        "output_file": "stock_warehouse_clean.csv",
        "fields": [
          "id",
          "external_id",
          "name",
          "code",
          "company_id",
          "partner_id"
        ]
      }
    }
  ]
}
```

---

## ğŸ”§ COMPONENTES DEL SISTEMA

### 1. Orchestrator (`src/core/orchestrator.py`)

**Responsabilidad:** Coordinar todo el flujo de procesamiento

```python
class DataMasterProcessor:
    def __init__(self, config_path: str):
        self.config = ConfigLoader().load(config_path)
        self.stats = {}

    def execute_plan(self):
        """Ejecuta el plan completo de procesamiento"""
        logger.info("Iniciando procesamiento de data maestra...")

        for model_config in self.config['execution_plan']:
            if not model_config['enabled']:
                continue

            try:
                self._process_model(model_config)
            except Exception as e:
                logger.error(f"Error en {model_config['model_name']}: {e}")
                if self.config['global_settings']['stop_on_error']:
                    raise

        self._generate_global_summary()

    def _process_model(self, model_config: dict):
        """Procesa un modelo individual"""
        model_name = model_config['model_name']
        logger.info(f"Procesando modelo: {model_name}")

        # 1. Cargar data sucia
        input_file = os.path.join(
            self.config['global_settings']['input_directory'],
            model_config['input']['file']
        )
        registros = CSVReader().read(input_file)
        logger.info(f"Cargados {len(registros)} registros de {input_file}")

        # 2. Ejecutar operaciones
        executor = OperationExecutor()
        registros_limpios, id_map = executor.execute_all_operations(
            registros,
            model_config['operations']
        )
        logger.info(f"Procesados {len(registros_limpios)} registros limpios")

        # 3. Exportar data limpia
        if model_config['export']['enabled']:
            output_file = os.path.join(
                self.config['global_settings']['output_directory'],
                model_config['export']['output_file']
            )
            CSVExporter().export_to_csv(
                registros_limpios,
                output_file,
                model_config['export']['fields']
            )
            logger.info(f"Exportado a {output_file}")

        # 4. Generar reporte del modelo
        if self.config['global_settings']['generate_reports']:
            self._generate_model_report(model_name, registros, registros_limpios)
```

### 2. OperationExecutor (`src/operations/operation_executor.py`)

**Responsabilidad:** Ejecutar las operaciones de limpieza

```python
class OperationExecutor:
    def execute_all_operations(self, registros: list, operations: dict) -> tuple:
        """Ejecuta todas las operaciones configuradas"""

        # Op 2: Data Cleaning
        if operations.get('data_cleaning', {}).get('enabled'):
            registros = DataCleaner().clean(
                registros,
                operations['data_cleaning']
            )

        # Op 3: ID Resequencing
        id_map = {}
        if operations.get('resequence_ids', {}).get('enabled'):
            registros, id_map = IDResequencer().resequence(
                registros,
                operations['resequence_ids']
            )

        # Op 4: Metadata Generation
        if operations.get('generate_metadata', {}).get('enabled'):
            registros = MetadataGenerator().generate(
                registros,
                operations['generate_metadata']
            )

        # Op 5: M2M Handling
        if operations.get('m2m_relationships'):
            M2MHandler().process_relations(
                operations['m2m_relationships'],
                id_map
            )

        return registros, id_map
```

### 3. CSVReader (`src/readers/csv_reader.py`)

```python
class CSVReader:
    def read(self, file_path: str, encoding='utf-8') -> list:
        """Lee un archivo CSV y retorna lista de diccionarios"""
        import csv

        records = []
        with open(file_path, 'r', encoding=encoding) as f:
            reader = csv.DictReader(f)
            for row in reader:
                records.append(row)

        logger.info(f"LeÃ­dos {len(records)} registros de {file_path}")
        return records
```

### 4. CSVExporter (`src/exporters/csv_exporter.py`)

```python
class CSVExporter:
    def export_to_csv(self, records: list, output_file: str, fields: list):
        """Exporta registros a CSV"""
        import csv

        with open(output_file, 'w', encoding='utf-8', newline='') as f:
            writer = csv.DictWriter(f, fieldnames=fields)
            writer.writeheader()

            for record in records:
                # Filtrar solo campos configurados
                row = {k: record.get(k, '') for k in fields}
                writer.writerow(row)

        logger.info(f"Exportados {len(records)} registros a {output_file}")
```

---

## ğŸ“ DESCRIPCIÃ“N DE LAS 6 OPERACIONES

### OperaciÃ³n 1: FK Redefinition
**Estado:** SKIP en procesamiento CSV (aplicable solo en BD)
**Alternativa:** Validar integridad referencial

### OperaciÃ³n 2: Data Cleaning âœ…
- Filtrado de registros por condiciones
- EliminaciÃ³n de duplicados
- NormalizaciÃ³n de datos
- Limpieza de campos

### OperaciÃ³n 3: ID Resequencing âœ…
- Ordenamiento de registros
- CreaciÃ³n de mapeo old_id â†’ new_id
- AsignaciÃ³n de IDs consecutivos
- ActualizaciÃ³n de FKs

### OperaciÃ³n 4: Metadata Generation âœ…
- GeneraciÃ³n de External IDs
- CreaciÃ³n de archivo ir_model_data.csv
- Formato: module.model_id

### OperaciÃ³n 5: M2M Handling âœ…
- Procesamiento de archivos de relaciÃ³n M2M
- ActualizaciÃ³n de IDs con mapeo
- ExportaciÃ³n de relaciones limpias

### OperaciÃ³n 6: Sequence Update
**Estado:** SKIP en procesamiento CSV (aplicable solo en BD)
**Alternativa:** Generar archivo sequences.json

---

## ğŸš€ EJEMPLO DE EJECUCIÃ“N

### Comando Principal

```bash
# EjecuciÃ³n completa
python scripts/run_processor.py \
  --config config/models_config.json

# Con opciones
python scripts/run_processor.py \
  --config config/models_config.json \
  --log-level DEBUG \
  --verbose

# Validar configuraciÃ³n antes
python scripts/validate_config.py \
  --config config/models_config.json

# Validar archivos de entrada
python scripts/validate_input_files.py \
  --config config/models_config.json
```

### Salida Esperada

```
============================================================
INICIANDO PROCESAMIENTO DE DATA MAESTRA
============================================================
[14:30:00] [INFO] Cargando configuraciÃ³n...
[14:30:01] [INFO] Modelos a procesar: 15

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Procesando modelo 1/15: res.partner
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[14:30:02] [INFO] Cargados 8,590 registros
[14:30:03] [INFO] OperaciÃ³n 2: Data Cleaning
[14:30:05] [INFO]   âœ“ 250 registros filtrados
[14:30:05] [INFO]   âœ“ 15 duplicados eliminados
[14:30:05] [INFO]   âœ“ Datos normalizados
[14:30:06] [INFO] OperaciÃ³n 3: ID Resequencing
[14:30:08] [INFO]   âœ“ 8,325 IDs re-secuenciados
[14:30:08] [INFO] OperaciÃ³n 4: Metadata Generation
[14:30:10] [INFO]   âœ“ 8,325 External IDs generados
[14:30:10] [INFO] Exportando a CSV...
[14:30:12] [INFO]   âœ“ Exportado: data/output/res_partner_clean.csv
[14:30:12] [INFO] Modelo res.partner completado âœ“

============================================================
RESUMEN GLOBAL
============================================================
Modelos procesados: 15 / 15
Registros totales: 45,230
Registros limpios: 44,100
External IDs creados: 44,100

Tiempo total: 2m 15s
Estado: âœ“ EXITOSO
============================================================
```

---

## ğŸ“… PLAN DE IMPLEMENTACIÃ“N

### Fase 1: Setup Inicial (3 dÃ­as)
- âœ… Crear estructura de directorios
- âœ… Configurar entorno virtual
- âœ… Instalar dependencias
- âœ… Crear ConfigLoader bÃ¡sico
- âœ… Crear sistema de logging

### Fase 2: Lectores y Exportadores (3 dÃ­as)
- âœ… CSVReader completo
- âœ… CSVExporter completo
- âœ… Validadores bÃ¡sicos
- âœ… Tests unitarios

### Fase 3: Operaciones BÃ¡sicas (5 dÃ­as)
- âœ… OperaciÃ³n 2: Data Cleaning
- âœ… OperaciÃ³n 3: ID Resequencing
- âœ… Tests con datos reales

### Fase 4: Metadata y M2M (3 dÃ­as)
- âœ… OperaciÃ³n 4: Metadata Generation
- âœ… OperaciÃ³n 5: M2M Handling
- âœ… Tests de integraciÃ³n

### Fase 5: Orchestrator y Reporting (3 dÃ­as)
- âœ… Orchestrator completo
- âœ… Sistema de reportes
- âœ… GeneraciÃ³n de resumen global

### Fase 6: Testing y DocumentaciÃ³n (3 dÃ­as)
- âœ… Tests de integraciÃ³n completos
- âœ… DocumentaciÃ³n de usuario
- âœ… Ejemplos de uso

**DuraciÃ³n total: 20 dÃ­as (4 semanas)**

---

**VersiÃ³n:** 1.0
**Fecha:** 2025-10-01
**Estado:** âœ… Listo para desarrollo
**Output Final:** Data maestra validada, limpia y lista para importar a BD Odoo
